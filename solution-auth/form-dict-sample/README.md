

## form-dict æ•°æ®åº“ ER å›¾

å¥½çš„ï¼Œæˆ‘ç»™ä½ ç”»ä¸€ä¸ªæ–‡å­—ç‰ˆçš„ ER å›¾ï¼Œå±•ç¤ºæ¨¡æ¿æ¨¡å—çš„æ•´ä½“ç»“æ„å’Œå­—æ®µå…³ç³»ï¼š

```yaml
tpl_template (æ¨¡æ¿è¡¨)
+--------------------+
| id (PK)            |
| template_code      |
| template_name      |
| template_type      |
| status             |
| remark             |
| create_time        |
| update_time        |
| created_by         |
| updated_by         |
| is_deleted         |
+--------------------+
|
| 1:N
v
tpl_template_field (æ¨¡æ¿å­—æ®µè¡¨)
+-----------------------------+
| id (PK)                     |
| template_id (FK) â†’ tpl_template.id |
| field_code                  |
| field_name                  |
| field_type                  |
| option_source (1=å­—å…¸,2=ä¸“å±é€‰é¡¹,3=è‡ªç”±è¾“å…¥) |
| dict_code (å½“ option_source=1) |
| required                    |
| default_value               |
| field_sort                  |
| status                      |
| remark                      |
| create_time                 |
| update_time                 |
| created_by                  |
| updated_by                  |
| is_deleted                  |
+-----------------------------+
|
| 1:N (ä»…å½“ option_source=2 ä½¿ç”¨)
v
tpl_template_field_option (æ¨¡æ¿å­—æ®µä¸“å±é€‰é¡¹è¡¨)
+-----------------------------+
| id (PK)                     |
| template_id (FK) â†’ tpl_template.id |
| field_id (FK) â†’ tpl_template_field.id |
| option_code                 |
| option_name                 |
| option_value                |
| version                     |
| sort_order                  |
| status                      |
| create_time                 |
| update_time                 |
| created_by                  |
| updated_by                  |
| is_deleted                  |
+-----------------------------+

tpl_template_data (æ¨¡æ¿å½•å…¥æ•°æ®è¡¨)
+-----------------------------+
| id (PK)                     |
| template_id (FK) â†’ tpl_template.id |
| record_id (æ ‡è¯†ä¸€æ¬¡å®Œæ•´å½•å…¥) |
| field_code                  |
| field_value                 |
| create_time                 |
| update_time                 |
| created_by                  |
| updated_by                  |
| is_deleted                  |
+-----------------------------+
```
ğŸ”¹ è¯´æ˜
1.	tpl_template â†’ tpl_template_field
â€¢	ä¸€ä¸ªæ¨¡æ¿æœ‰å¤šä¸ªå­—æ®µ
2.	tpl_template_field â†’ tpl_template_field_option
â€¢	ä»…å½“å­—æ®µæ¥æºä¸ºâ€œæ¨¡æ¿ä¸“å±é€‰é¡¹â€æ—¶æ‰æœ‰å¤šæ¡é€‰é¡¹
3.	tpl_template_data
â€¢	çºµè¡¨å­˜å‚¨å½•å…¥çš„æ•°æ®
â€¢	æ¯æ¬¡å½•å…¥ç”Ÿæˆä¸€ä¸ª record_idï¼Œå¯¹åº”æ¨¡æ¿ä¸‹çš„å¤šä¸ªå­—æ®µæ•°æ®
4.	å­—å…¸ç»‘å®š
â€¢	å½“ tpl_template_field.option_source=1 æ—¶ï¼Œdict_code å…³è”ç³»ç»Ÿå­—å…¸è¡¨ sys_dict / sys_dict_item
â€¢	å‰ç«¯æ˜¾ç¤ºæ—¶æ ¹æ®æ¥æºåŠ¨æ€é€‰æ‹©æ¥æºï¼šå­—å…¸æˆ–ä¸“å±é€‰é¡¹

â¸»

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥é¡ºå¸¦å¸®ä½ ç”»ä¸€ä¸ª å‰ç«¯äº¤äº’æµç¨‹å›¾ï¼Œå±•ç¤ºï¼š
â€¢	æ¨¡æ¿åˆ—è¡¨ â†’ å­—æ®µé…ç½® â†’ å½•å…¥æ•°æ® â†’ ä¸‹æ‹‰é€‰é¡¹æ¥æºåŠ¨æ€åˆ¤æ–­



## form-dict æ¨¡æ¿+å­—æ®µ+å­—å…¸+ä¸“å±é€‰é¡¹ æ•°æ®å½•å…¥æµç¨‹

æ˜ç™½äº†ï¼Œæˆ‘å¸®ä½ ç”»ä¸€ä¸ªæ–‡å­—ç‰ˆçš„ å‰ç«¯äº¤äº’æµç¨‹å›¾ï¼Œç»“åˆä½ å½“å‰æ¨¡æ¿+å­—æ®µ+å­—å…¸+ä¸“å±é€‰é¡¹çš„è®¾è®¡ï¼š

```yaml
ç”¨æˆ·è¿›å…¥æ¨¡æ¿ç®¡ç†é¡µé¢
    |
    v
tpl_template åˆ—è¡¨åˆ†é¡µå±•ç¤º
+--------------------------+
| æ¨¡æ¿ç¼–ç  | æ¨¡æ¿åç§° | çŠ¶æ€ |
+--------------------------+
| å¢åˆ æ”¹æŸ¥æŒ‰é’®             |
+--------------------------+
    |
    | ç‚¹å‡»â€œæŸ¥çœ‹/é…ç½®å­—æ®µâ€
    v
tpl_template_field åˆ—è¡¨åˆ†é¡µå±•ç¤º
+-----------------------------------------------------------+
| å­—æ®µç¼–ç  | å­—æ®µåç§° | ç±»å‹ | æ¥æº | å¿…å¡« | é»˜è®¤å€¼ | çŠ¶æ€ |
+-----------------------------------------------------------+
| å¢åˆ æ”¹æŸ¥æŒ‰é’®                                             |
+-----------------------------------------------------------+
    |
    | ç‚¹å‡»â€œæŸ¥çœ‹é€‰é¡¹â€ ï¼ˆä»… option_source=2ï¼‰
    v
tpl_template_field_option åˆ—è¡¨åˆ†é¡µå±•ç¤º
+---------------------------------------------+
| é€‰é¡¹ç¼–ç  | é€‰é¡¹åç§° | é€‰é¡¹å€¼ | ç‰ˆæœ¬ | æ’åº |
+---------------------------------------------+
| å¢åˆ æ”¹æŸ¥æŒ‰é’®                               |
+---------------------------------------------+

æ•°æ®å½•å…¥æµç¨‹ï¼š
ç”¨æˆ·é€‰æ‹©æ¨¡æ¿ â†’ å±•ç¤ºæ¨¡æ¿å­—æ®µ
    |
    v
å¾ªç¯å­—æ®µï¼š
- è‹¥ option_source=1 â†’ ä½¿ç”¨ sys_dict / sys_dict_item ä½œä¸ºä¸‹æ‹‰é€‰é¡¹
- è‹¥ option_source=2 â†’ ä½¿ç”¨ tpl_template_field_option ä½œä¸ºä¸‹æ‹‰é€‰é¡¹
- è‹¥ option_source=3 â†’ è‡ªç”±è¾“å…¥
      |
      v
  ç”¨æˆ·å¡«å†™è¡¨å• â†’ ç‚¹å‡»ä¿å­˜
      |
      v
  tpl_template_data å†™å…¥çºµè¡¨ï¼š
  (record_id, template_id, field_code, field_value)
      |
      v
  å½•å…¥å®Œæˆ
```
ğŸ”¹ ç‰¹ç‚¹
1.	å­—æ®µæ¥æºåŠ¨æ€åˆ¤æ–­
â€¢	åç«¯ç»Ÿä¸€æä¾›æ¥å£ï¼šgetFieldOptions(fieldId)
â€¢	å‰ç«¯æ— éœ€å…³å¿ƒæ˜¯å­—å…¸è¿˜æ˜¯æ¨¡æ¿ä¸“å±é€‰é¡¹
2.	çºµè¡¨æ•°æ®å½•å…¥
â€¢	æ¯æ¬¡å½•å…¥ç”Ÿæˆä¸€ä¸ª record_idï¼Œå¯¹åº”æ¨¡æ¿å­—æ®µçš„å¤šæ¡æ•°æ®
3.	ç‰ˆæœ¬/æ‰©å±•å…¼å®¹
â€¢	æ¨¡æ¿å­—æ®µé€‰é¡¹æ”¯æŒç‰ˆæœ¬
â€¢	åç»­å¯åšå­—æ®µç‰ˆæœ¬åŒ–æˆ–å¤šç§Ÿæˆ·å·®å¼‚åŒ–è¡¨å•

â¸»

